{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"intro","text":"Semgrep-based Policy controller for Kubernetes.  <p>Admission controller to use your well-known publicly available or custom Semgrep rules to validate k8s resources before deployment to the cluster.</p> <p> developed by </p> <p> powered by </p> <p> semgr8s is in a proof-of-concept state. Do not use in production. Breaking changes, service interruptions, and development flow adjustments are expected.</p>"},{"location":"#getting-started","title":"Getting started","text":"<p>Getting started to validate Kubernetes resources against Semgrep rules is only a matter of minutes:</p> <p> </p>"},{"location":"#requirements","title":"Requirements","text":"<ul> <li>git</li> <li>yq v4.x</li> <li>Kubernetes cluster for testing (e.g. kind, microk8s, or minikube)</li> <li>kubectl</li> <li>Helm</li> <li>(optional) make (e.g. via build-essential)</li> <li>(optional) docker</li> </ul>"},{"location":"#get-code","title":"Get Code","text":"<p>Installation files are contained within this repository:</p> <pre><code>git clone https://github.com/sse-secure-systems/semgr8s.git\ncd semgr8s\n</code></pre>"},{"location":"#configuration-installation","title":"Configuration &amp; Installation","text":"<p>Semgr8s comes preconfigured with some basic rules. However, configuration can be adjusted to your needs:</p> <ul> <li>Central configuration is maintained in <code>charts/semgr8s/values.yaml</code>.</li> <li>Configuration aims to provide the most native integration of Semgrep's functionality into Kubernetes. Working knowledge of Kubernetes and the Semgrep documentation should be sufficient to understand the concepts and options being used here.</li> <li>Remote Semgrep rules, rulesets, repository rules are configured via <code>.application.remoteRules</code> in <code>charts/semgr8s/values.yaml</code>, e.g. set to <code>\"r/yaml.kubernetes.security.allow-privilege-escalation.allow-privilege-escalation\"</code> or <code>\"p/kubernetes\"</code>, or <code>\"r/yaml.kubernetes\"</code> respectively.</li> <li>Custom Semgrep rules can placed in <code>charts/semgr8s/rules/</code> and will be auto-mounted into the admission controller.</li> <li>Semgrep provides online tools to learn and create custom rules.</li> </ul> <p>To deploy the preconfigured admission controller simply run:</p> <pre><code>helm install semgr8s charts/semgr8s --create-namespace --namespace semgr8ns\n</code></pre> output <pre><code>NAME: semgr8s\nLAST DEPLOYED: Tue Apr 25 00:16:04 2023\nNAMESPACE: semgr8ns\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nSuccessfully installed semgr8s!\n</code></pre> <p>You can check successful deployment of semgr8s via:</p> <pre><code>kubectl get all -n semgr8ns\n</code></pre> output <pre><code>NAME                           READY   STATUS    RESTARTS   AGE\npod/semgr8s-665dbb8756-qhqv6   1/1     Running   0          7s\n\nNAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nservice/semgr8s-service   ClusterIP   10.96.135.157   &lt;none&gt;        443/TCP   7s\n\nNAME                      READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/semgr8s   1/1     1            1           7s\n\nNAME                                 DESIRED   CURRENT   READY   AGE\nreplicaset.apps/semgr8s-665dbb8756   1         1         1       7s\n</code></pre> <p>Once all resources are in <code>READY</code> state, you have successfully installed semgr8s </p>"},{"location":"#testing","title":"Testing","text":"<p>Several test resources are provided under <code>tests/demo/</code>. Semgr8s only validates resources in namespaces with label <code>semgr8s/validation=enabled</code>:</p> <pre><code>kubectl apply -f tests/demo/00_test-namespace.yaml\n</code></pre> output <pre><code>namespace/test-semgr8s created\n</code></pre> <p>It denies creating pods with non-compliant configuration according to the local rules in <code>charts/semgr8s/rules</code> and <code>.application.remoteRules</code> <code>charts/semgr8s/values.yaml</code>:</p> <pre><code>kubectl apply -f tests/demo/40_failing-deployment.yaml\n</code></pre> output <pre><code>Error from server: error when creating \"tests/demo/40_failing-deployment.yaml\": admission webhook \"semgr8s-svc.semgr8ns.svc\" denied the request: Found 1 violation(s) of the following policies: \n* rules.test-semgr8s-forbidden-label\nError from server: error when creating \"tests/demo/40_failing-deployment.yaml\": admission webhook \"semgr8s-svc.semgr8ns.svc\" denied the request: Found 1 violation(s) of the following policies: \n* yaml.kubernetes.security.writable-filesystem-container.writable-filesystem-container\nError from server: error when creating \"tests/demo/40_failing-deployment.yaml\": admission webhook \"semgr8s-svc.semgr8ns.svc\" denied the request: Found 1 violation(s) of the following policies: \n* yaml.kubernetes.security.privileged-container.privileged-container\nError from server: error when creating \"tests/demo/40_failing-deployment.yaml\": admission webhook \"semgr8s-svc.semgr8ns.svc\" denied the request: Found 1 violation(s) of the following policies: \n* yaml.kubernetes.security.hostnetwork-pod.hostnetwork-pod\n</code></pre> <p>Compliantly configured resources on the other hand are permitted to the cluster:</p> <pre><code>kubectl apply -f tests/demo/20_passing-deployment.yaml\n</code></pre> output <pre><code>pod/passing-testpod-1 created\n</code></pre>"},{"location":"#cleanup","title":"Cleanup","text":"<p>To remove all resources of the admission controller run:</p> <pre><code>helm uninstall semgr8s -n semgr8ns\nkubectl delete ns semgr8ns\n</code></pre> output <pre><code>release \"semgr8s\" uninstalled\n</code></pre> <p>Test resources are deleted via:</p> <pre><code>kubectl delete -f tests/demo/\n</code></pre> output <pre><code>namespace \"test-semgr8s\" deleted\npod \"passing-testpod-1\" deleted\nError from server (NotFound): error when deleting \"tests/demo/40_failing-deployment.yaml\": pods \"forbiddenlabel-pod\" not found\nError from server (NotFound): error when deleting \"tests/demo/40_failing-deployment.yaml\": pods \"failing-testpod-1\" not found\nError from server (NotFound): error when deleting \"tests/demo/40_failing-deployment.yaml\": pods \"failing-testpod-2\" not found\nError from server (NotFound): error when deleting \"tests/demo/40_failing-deployment.yaml\": pods \"failing-testpod-3\" not found\n</code></pre>"},{"location":"usage/","title":"usage","text":""},{"location":"usage/#how-semgr8s-works","title":"how semgr8s works","text":""}]}